<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Multiple choropleth maps</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <script type="text/javascript" src="js/mapbox.js?v=2.2.2"></script>
    <script type="text/javascript" src="js/jquery.js"></script>

    <link rel="stylesheet" type="text/css" href="css/reset.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">

    <link href="css/leaflet.css" rel="stylesheet" />
</head>
<body>



<div id="map"></div>

<div id="variablesButton">
    <a id="hamburger" onclick="metroMode ()"></a>
    <div class="content"></div>
</div>

<div id="legenda"></div>

<script type="text/javascript">

L.mapbox.accessToken = 'pk.eyJ1IjoibWFwYm94IiwiYSI6IjZjNmRjNzk3ZmE2MTcwOTEwMGY0MzU3YjUzOWFmNWZhIn0.Y8bhBaUMqFiPrDRW9hieoQ';
var map = L.mapbox.map(
        'map', 'mapbox.light', {zoomControl: false})
    .setView([53, 20], 3);

// Be nice and credit our data source, Census Reporter.
// map.attributionControl.addAttribution('Data from ' +
//   '<a href="http://censusreporter.org/data/map/?table=B06011&geo_ids=040%7C01000US#">' +
//   'Census Reporter</a>');












// Choropleth colors from http://colorbrewer2.org/
// You can choose your own range (or different number of colors)
// and the code will compensate.
var hues = [
    '#eff3ff',
    '#bdd7e7',
    '#6baed6',
    '#3182bd',
    '#08519c'];

// The names of variables that we'll show in the UI for
// styling. These need to match exactly.
var variables = [
    'gino',
    'freedom',
    'werkloos-man',
    'werkloos-vrouw',
    'vluchteling-10k-inwoner',
    'uurloon-gemiddelde'
    ];

var variablesUI = [
    'Inkomensongelijkheid',
    'Persvrijheid',
    'Werkloos mannen',
    'Werkloos vrouwen',
    'Vluchteling per 10000 inwoners',
    'Kosten uurloon per uur'
    ];


for (var i = 0; i < variables.length; i++) {
    document.querySelector("#variablesButton .content").innerHTML += "<li class='" + variables[i]+ "'> <img src='images/"  + variables[i] + ".svg' /> <a onclick='setVariable(\"" + variables[i]  + "\")'>" + variablesUI[i] +"</a> </li>";
}


// var variables = [
//     'B06011002 - Born in state of residence',
//     'B06011003 - Born in other state of the United States',
//     'B06011004 - Native; born outside the United States'];




// Collect the range of each variable over the full set, so
// we know what to color the brightest or darkest.
var ranges = {};
var $select = $('<select></select>')
    .appendTo($('#variables'))
    .on('change', function() {
        setVariable($(this).val());
    });
for (var i = 0; i < variables.length; i++) {
    ranges[variables[i]] = { min: Infinity, max: -Infinity };
    // Simultaneously, build the UI for selecting different
    // ranges
    $('<option></option>')
        .text(variables[i])
        .attr('value', variables[i])
        .appendTo($select);
}

// Create a layer of state features, and when it's done
// loading, run loadData
var euLayer = L.mapbox.featureLayer()
    .loadURL('data/europe.geo.json')
    .addTo(map)
    .on('ready', loadData);


// var euLayer = L.mapbox.featureLayer()
//     .loadURL('data/europe.geo.json')
//     .addTo(map)
//     .on('ready', loadData);

  // var statesLayer = L.geoJson(statesData,  {
  //     style: getStyle,
  //     onEachFeature: onEachFeature
  // }).addTo(mapdataviz);


    // .loadURL('https://www.mapbox.com/mapbox.js/assets/data/us.geojson')


// Grab the spreadsheet of data as JSON. If you have CSV
// data, you should convert it to JSON with
// http://shancarter.github.io/mr-data-converter/
function loadData() {
    $.getJSON('data/data.json')
        .done(function(data) {
            joinData(data, euLayer);
        });
}
//     $.getJSON('https://www.mapbox.com/mapbox.js/assets/data/censusdata.json')


function joinData(data, layer) {
    // First, get the US state GeoJSON data for reference.

    var euGeoJSON = euLayer.getGeoJSON(),
        byState = {};

    // Rearrange it so that instead of being a big array,
    // it's an object that is indexed by the state name,
    // that we'll use to join on.
    for (var i = 0; i < euGeoJSON.features.length; i++) {
        
        // console.log(byState);

        byState[euGeoJSON.features[i].properties.name] =
            euGeoJSON.features[i];
    }
    for (i = 0; i < data.length; i++) {

     // Match the GeoJSON data (byState) with the tabular data
        // (data), replacing the GeoJSON feature properties
        // with the full data.
        try {
            byState[data[i].name].properties = data[i];

        }
        catch(e){}

        for (var j = 0; j < variables.length; j++) {
            // Simultaneously build the table of min and max
            // values for each attribute.

            var n = variables[j];
            ranges[n].min = Math.min(data[i][n], ranges[n].min);
            ranges[n].max = Math.max(data[i][n], ranges[n].max);

        }
    }
    // Create a new GeoJSON array of features and set it
    // as the new usLayer content.
    var newFeatures = [];
    for (i in byState) {
        newFeatures.push(byState[i]);
    }
    euLayer.setGeoJSON(newFeatures);




 

    // Kick off by filtering on an attribute.
    setVariable(variables[0]);
}







// Excuse the short function name: this is not setting a JavaScript
// variable, but rather the variable by which the map is colored.
// The input is a string 'name', which specifies which column
// of the imported JSON file is used to color the map.
function setVariable(name) {
    var scale = ranges[name];
    euLayer.eachLayer(function(layer) {
        // Decide the color for each state by finding its
        // place between min & max, and choosing a particular
        // color as index.
        var division = Math.floor(
            (hues.length - 1) *
            ((layer.feature.properties[name] - scale.min) /
            (scale.max - scale.min)));
        // See full path options at
        // http://leafletjs.com/reference.html#path
        layer.setStyle({
            fillColor: hues[division],
            fillOpacity: 0.8,
            weight: 0.5
        });

        layer.addEventListener("mouseover", function(e){ var those = this; hoverLegenda(e,those,name) }, false);

    });


    setColorOfVariablesButton (name)
    metroMode ()
}

var isMetroOn = false;

function metroMode () {
    if (isMetroOn == true) {
        $( "#variablesButton").css("width", "50px" );
        $( "#variablesButton").css("height", "50px" );
        $( "#variablesButton .content").css("display", "none" );

        isMetroOn = false;
    }
    else {
        $( "#variablesButton").css("width", "100vw" );
        $( "#variablesButton").css("height", "100vh" );        
        $( "#variablesButton .content").css("display", "block" );

        isMetroOn = true;

    }


}

function setColorOfVariablesButton (name) {




    $( "#variablesButton" ).each(function() {
        $( this ).css( "backgroundColor", "white" );
    });


    $('#variablesButton').children('li').each(function () {
        $( this ).css( "backgroundColor", "white" );
        // alert(this.value); // "this" is the current element in the loop
    });

    $( "#variablesButton" + " ." + name).css("backgroundColor", "red" );


}

function hoverLegenda (e,those,name) {
    // console.dir(e)
    // console.log(e.target.feature.properties[name])




    // 'gino',
    // 'freedom',
    // 'werkloos-man',
    // 'werkloos-vrouw',
    // 'vluchteling-10k-inwoner',
    // 'uurloon-gemiddelde'

    var scale;
    switch(name) {
        case "gino":
            scale = "percentage van het inkomen is ongelijker dan het europese gemiddelde";
        break;

        case "freedom":
            scale = "raking van reporters Without Borders index";
        break;

        case "werkloos-man":
            scale = "% van de manelijke bevolking is werkloos";
        break;

        case "werkloos-vrouw":
            scale = "% van de vrouwlijke bevolking is werkloos";
        break;

        case "vluchteling-10k-inwoner":
            scale = "aantal vluchtelingen per 10000 inwoners (alleen 2015)";
        break;
        
        case "uurloon-gemiddelde":
            scale = "gemiddelde kosten voor één uur werk in euro's";
        break;

        default:
            scale = "%";

    }

    var value = e.target.feature.properties[name];
    value = Math.round(value);

    if (e.target.feature.properties[name] == -9) {
        value = "geen data"
    };

    document.getElementById("legenda").innerHTML = e.target.feature.properties["nl_name"] + " " + value + " " + scale;



}





</script>


</body>
</html>

